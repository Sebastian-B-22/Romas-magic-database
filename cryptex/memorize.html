<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memorize Ciphers - The Cryptex</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e8e8e8;
            min-height: 100vh;
        }

        header {
            background: rgba(0,0,0,0.4);
            padding: 1.5rem;
            text-align: center;
            border-bottom: 2px solid #e94560;
        }

        .logo { font-size: 2rem; font-weight: 900; color: #e94560; }
        .tagline { color: #888; margin-top: 0.3rem; }

        main {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .back-link {
            display: inline-block;
            color: #e94560;
            text-decoration: none;
            margin-bottom: 1.5rem;
        }

        .setup {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(233,69,96,0.3);
        }

        .setup h2 {
            color: #e94560;
            margin-bottom: 1rem;
        }

        .cipher-select {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.6rem;
            margin-bottom: 1rem;
        }

        .cipher-opt {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .cipher-opt:hover { background: rgba(233,69,96,0.2); }
        .cipher-opt.selected { border-color: #10b981; background: rgba(16,185,129,0.2); }
        .cipher-opt input { display: none; }
        .cipher-opt .check { color: #10b981; font-weight: bold; }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .btn-primary { background: linear-gradient(135deg, #e94560, #c73659); color: white; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #ccc; }
        .btn:hover { transform: scale(1.02); }

        /* Quiz Area */
        .quiz-area {
            display: none;
        }

        .quiz-area.active { display: block; }

        .progress {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .progress-text { color: #888; }
        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            min-width: 100px;
        }
        .progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s;
        }

        .score { color: #10b981; font-weight: 700; }

        /* The Quiz Card */
        .quiz-card {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            border: 2px solid rgba(233,69,96,0.3);
        }

        .cipher-label {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .cipher-name {
            color: #e94560;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .encoded-text {
            background: #0a0a15;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1rem;
        }

        .encoded {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            color: #7dd3fc;
            font-weight: bold;
            word-break: break-all;
        }

        .equals {
            font-size: 2rem;
            color: #e94560;
            margin: 1rem 0;
        }

        .answer-blank {
            font-size: 2.5rem;
            color: #f59e0b;
            font-weight: bold;
            letter-spacing: 0.3rem;
        }

        .hint-text {
            color: #666;
            font-size: 0.9rem;
            margin-top: 1rem;
            font-style: italic;
        }

        /* Answer reveal */
        .answer-section {
            margin-top: 1.5rem;
            display: none;
        }

        .answer-section.revealed { display: block; }

        .answer-box {
            background: rgba(16,185,129,0.2);
            border: 2px solid #10b981;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .answer-label {
            color: #10b981;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .answer-word {
            font-size: 2.5rem;
            color: #10b981;
            font-weight: bold;
        }

        .card-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        .card-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-reveal { background: #6b7280; color: white; }
        .btn-check { background: #10b981; color: white; }
        .btn-next { background: #3b82f6; color: white; }

        .type-answer {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
            margin: 1rem 0;
        }

        .type-answer input {
            padding: 1rem 1.5rem;
            font-size: 1.5rem;
            border: 3px solid #e94560;
            border-radius: 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            text-align: center;
            text-transform: uppercase;
            width: 200px;
            font-weight: bold;
        }

        .type-answer input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 15px rgba(16,185,129,0.3);
        }

        .type-answer input::placeholder {
            color: #555;
            text-transform: none;
            font-weight: normal;
        }

        .answer-box.correct {
            background: rgba(16,185,129,0.2);
            border-color: #10b981;
        }

        .answer-box.correct .answer-label { color: #10b981; }
        .answer-box.correct .answer-word { color: #10b981; }

        .answer-box.wrong {
            background: rgba(239,68,68,0.2);
            border-color: #ef4444;
        }

        .answer-box.wrong .answer-label { 
            color: #ef4444; 
            font-size: 1.5rem;
        }
        .answer-box.wrong .answer-word { 
            color: #10b981; 
            font-size: 3rem;
            background: rgba(16,185,129,0.2);
            padding: 0.5rem 1rem;
            border-radius: 10px;
            display: inline-block;
        }

        .you-said {
            color: #888;
            margin: 0.5rem 0;
        }

        .you-said span {
            color: #ef4444;
            font-weight: bold;
            text-decoration: line-through;
        }

        .correct-was {
            color: #10b981;
            font-weight: bold;
            margin-top: 0.5rem;
        }

        .answer-extra {
            color: #888;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Reference Chart */
        .chart-toggle {
            background: rgba(139, 92, 246, 0.3);
            border: 2px solid #8b5cf6;
            color: #c4b5fd;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .chart-toggle:hover {
            background: rgba(139, 92, 246, 0.5);
        }

        .reference-chart {
            display: none;
            background: rgba(0,0,0,0.5);
            border: 2px solid #8b5cf6;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .reference-chart.show {
            display: block;
        }

        .reference-chart pre {
            color: #c4b5fd;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            text-align: left;
            margin: 0;
            line-height: 1.6;
        }

        .btn-gotit {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        /* Results */
        .results {
            display: none;
            text-align: center;
            padding: 3rem;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
        }

        .results.active { display: block; }
        .results h2 { color: #10b981; font-size: 2rem; margin-bottom: 1rem; }
        .results .emoji { font-size: 5rem; margin-bottom: 1rem; }
        .results p { color: #888; margin-bottom: 1.5rem; }
        .results .stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .results .stat { text-align: center; }
        .results .stat-num { font-size: 2.5rem; font-weight: 700; color: #e94560; }
        .results .stat-label { color: #888; }
    </style>
</head>
<body>

<header>
    <div class="logo">üß† Memorize Mode</div>
    <p class="tagline">Can you decode these?</p>
</header>

<main>
    <a href="index.html" class="back-link">‚Üê Back to The Cryptex</a>

    <!-- Setup -->
    <div class="setup" id="setup">
        <h2>üìã Step 1: Pick Which Ciphers to Learn!</h2>
        <p style="color: #888; margin-bottom: 1rem;">Click to select/unselect. Only selected ciphers will appear in the quiz!</p>
        <div class="cipher-select" id="cipherSelect"></div>
        <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <button class="btn btn-secondary" onclick="selectAll()">‚úÖ Select All</button>
            <button class="btn btn-secondary" onclick="selectNone()">‚ùå Clear All</button>
        </div>
        <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
            <h3 style="color: #10b981; margin-bottom: 0.5rem;">Step 2: Start!</h3>
            <button class="btn btn-primary" onclick="startQuiz()" style="font-size: 1.2rem; padding: 1rem 2rem;">üöÄ Start Quiz!</button>
        </div>
    </div>

    <!-- Quiz Area -->
    <div class="quiz-area" id="quizArea">
        <div class="progress">
            <span class="progress-text"><span id="current">1</span> / <span id="total">10</span></span>
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <span class="score">‚úÖ <span id="score">0</span></span>
        </div>

        <div class="quiz-card" id="quizCard">
            <div class="cipher-label">Decode this:</div>
            <div class="cipher-name" id="cipherName">üèõÔ∏è Caesar Cipher (+1)</div>
            
            <!-- Reference Chart Toggle -->
            <button class="chart-toggle" onclick="toggleChart()">üìñ Show Reference Chart</button>
            <div class="reference-chart" id="referenceChart">
                <pre id="chartContent">Chart will appear here</pre>
            </div>
            
            <div class="encoded-text">
                <div class="encoded" id="encodedText">IFMMP</div>
            </div>
            
            <div class="equals">=</div>
            
            <div class="type-answer">
                <input type="text" id="answerInput" placeholder="Type your answer..." autocomplete="off" onkeypress="if(event.key==='Enter')checkAnswer()">
                <button class="card-btn btn-check" onclick="checkAnswer()">‚úì Check</button>
            </div>
            
            <div class="hint-text" id="hintText">Think about how this cipher works...</div>

            <div class="answer-section" id="answerSection">
                <div class="answer-box correct" id="correctBox" style="display:none;">
                    <div class="answer-label">‚úÖ CORRECT!</div>
                    <div class="answer-word" id="answerWord">HELLO</div>
                    <div class="answer-extra">Great job! üéâ</div>
                </div>
                <div class="answer-box wrong" id="wrongBox" style="display:none;">
                    <div class="answer-label">‚ùå WRONG!</div>
                    <div class="you-said">You typed: <span id="yourAnswer">???</span></div>
                    <div class="correct-was">The correct answer is:</div>
                    <div class="answer-word" id="wrongAnswer">HELLO</div>
                    <div class="answer-extra">Remember this for next time! üìù</div>
                </div>
            </div>

            <div class="card-buttons">
                <button class="card-btn btn-reveal" id="revealBtn" onclick="revealAnswer()">ü§∑ I Don't Know</button>
                <button class="card-btn btn-gotit" id="gotitBtn" onclick="gotIt()" style="display:none;">üéâ I Got It! (Hide Chart)</button>
                <button class="card-btn btn-next" id="nextBtn" onclick="nextQuestion()" style="display:none;">‚û°Ô∏è Next Question</button>
            </div>
        </div>
    </div>

    <!-- Results -->
    <div class="results" id="results">
        <div class="emoji">üéâ</div>
        <h2>Quiz Complete!</h2>
        <div class="stats">
            <div class="stat">
                <div class="stat-num" id="knownCount">0</div>
                <div class="stat-label">Correct</div>
            </div>
            <div class="stat">
                <div class="stat-num" id="learningCount">0</div>
                <div class="stat-label">Missed</div>
            </div>
        </div>
        <p id="resultMessage">Keep practicing!</p>
        <button class="btn btn-primary" onclick="restart()">üîÑ Try Again</button>
        <button class="btn btn-secondary" onclick="backToSetup()">üìã Change Ciphers</button>
    </div>
</main>

<script>
// Quiz questions - encoded = ?, answer = decoded word
const quizData = [
    // MORSE CODE - Full Alphabet!
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚àí', answer: 'A', hint: 'Dot dash = A', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚Ä¢‚Ä¢‚Ä¢', answer: 'B', hint: 'Dash dot dot dot', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚Ä¢‚àí‚Ä¢', answer: 'C', hint: 'Dash dot dash dot', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚Ä¢‚Ä¢', answer: 'D', hint: 'Dash dot dot', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢', answer: 'E', hint: 'Single dot!', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚Ä¢‚àí‚Ä¢', answer: 'F', hint: 'Dot dot dash dot', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚àí‚Ä¢', answer: 'G', hint: 'Dash dash dot', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢', answer: 'H', hint: 'Four dots!', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚Ä¢', answer: 'I', hint: 'Two dots', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚àí‚àí‚àí', answer: 'J', hint: 'Dot dash dash dash', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚Ä¢‚àí', answer: 'K', hint: 'Dash dot dash', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚àí‚Ä¢‚Ä¢', answer: 'L', hint: 'Dot dash dot dot', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚àí', answer: 'M', hint: 'Two dashes', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚Ä¢', answer: 'N', hint: 'Dash dot', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚àí‚àí', answer: 'O', hint: 'Three dashes!', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚àí‚àí‚Ä¢', answer: 'P', hint: 'Dot dash dash dot', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚àí‚Ä¢‚àí', answer: 'Q', hint: 'Dash dash dot dash', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚àí‚Ä¢', answer: 'R', hint: 'Dot dash dot', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚Ä¢‚Ä¢', answer: 'S', hint: 'Three dots!', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí', answer: 'T', hint: 'Single dash!', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚Ä¢‚àí', answer: 'U', hint: 'Dot dot dash', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚Ä¢‚Ä¢‚àí', answer: 'V', hint: 'Dot dot dot dash', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚àí‚àí', answer: 'W', hint: 'Dot dash dash', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚Ä¢‚Ä¢‚àí', answer: 'X', hint: 'Dash dot dot dash', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚Ä¢‚àí‚àí', answer: 'Y', hint: 'Dash dot dash dash', blanks: '_' },
    { cipher: 'üì° Morse Code', encoded: '‚àí‚àí‚Ä¢‚Ä¢', answer: 'Z', hint: 'Dash dash dot dot', blanks: '_' },
    
    // A1Z26 - Full Alphabet!
    { cipher: 'üî¢ A1Z26', encoded: '1', answer: 'A', hint: 'First letter!', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '2', answer: 'B', hint: 'Second letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '3', answer: 'C', hint: 'Third letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '5', answer: 'E', hint: 'Fifth letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '8', answer: 'H', hint: 'Eighth letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '9', answer: 'I', hint: 'Ninth letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '12', answer: 'L', hint: 'Twelfth letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '13', answer: 'M', hint: 'Middle of alphabet!', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '14', answer: 'N', hint: 'After M (13)', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '15', answer: 'O', hint: 'Fifteenth letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '18', answer: 'R', hint: '18th letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '19', answer: 'S', hint: '19th letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '20', answer: 'T', hint: '20th letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '24', answer: 'X', hint: '24th letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '25', answer: 'Y', hint: '25th letter', blanks: '_' },
    { cipher: 'üî¢ A1Z26', encoded: '26', answer: 'Z', hint: 'Last letter!', blanks: '_' },
    
    // NATO - Full Alphabet!
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Alpha', answer: 'A', hint: 'A = Alpha', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Bravo', answer: 'B', hint: 'B = Bravo', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Charlie', answer: 'C', hint: 'C = Charlie', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Delta', answer: 'D', hint: 'D = Delta', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Echo', answer: 'E', hint: 'E = Echo', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Foxtrot', answer: 'F', hint: 'F = Foxtrot', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Golf', answer: 'G', hint: 'G = Golf', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Hotel', answer: 'H', hint: 'H = Hotel', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'India', answer: 'I', hint: 'I = India', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Juliet', answer: 'J', hint: 'J = Juliet', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Kilo', answer: 'K', hint: 'K = Kilo', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Lima', answer: 'L', hint: 'L = Lima', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Mike', answer: 'M', hint: 'M = Mike', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'November', answer: 'N', hint: 'N = November', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Oscar', answer: 'O', hint: 'O = Oscar', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Papa', answer: 'P', hint: 'P = Papa', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Quebec', answer: 'Q', hint: 'Q = Quebec', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Romeo', answer: 'R', hint: 'R = Romeo', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Sierra', answer: 'S', hint: 'S = Sierra', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Tango', answer: 'T', hint: 'T = Tango', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Uniform', answer: 'U', hint: 'U = Uniform', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Victor', answer: 'V', hint: 'V = Victor', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Whiskey', answer: 'W', hint: 'W = Whiskey', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'X-ray', answer: 'X', hint: 'X = X-ray', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Yankee', answer: 'Y', hint: 'Y = Yankee', blanks: '_' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Zulu', answer: 'Z', hint: 'Z = Zulu', blanks: '_' },
    
    // Braille - Key letters
    { cipher: '‚†É Braille', encoded: '‚†Å', answer: 'A', hint: 'Single dot top-left', blanks: '_' },
    { cipher: '‚†É Braille', encoded: '‚†É', answer: 'B', hint: 'Two dots down left side', blanks: '_' },
    { cipher: '‚†É Braille', encoded: '‚†â', answer: 'C', hint: 'Two dots on top', blanks: '_' },
    { cipher: '‚†É Braille', encoded: '‚†ë', answer: 'E', hint: 'Top-left and middle-left', blanks: '_' },
    { cipher: '‚†É Braille', encoded: '‚†ì', answer: 'H', hint: 'H pattern', blanks: '_' },
    { cipher: '‚†É Braille', encoded: '‚†ä', answer: 'I', hint: 'Middle two left dots', blanks: '_' },
    { cipher: '‚†É Braille', encoded: '‚†á', answer: 'L', hint: 'Three dots down left', blanks: '_' },
    { cipher: '‚†É Braille', encoded: '‚†ï', answer: 'O', hint: 'O pattern', blanks: '_' },
    { cipher: '‚†É Braille', encoded: '‚†é', answer: 'S', hint: 'Middle and bottom left', blanks: '_' },
    { cipher: '‚†É Braille', encoded: '‚†û', answer: 'T', hint: 'T pattern', blanks: '_' },

    // Caesar +1
    { cipher: 'üèõÔ∏è Caesar (+1)', encoded: 'IFMMP', answer: 'HELLO', hint: 'Shift each letter back by 1', blanks: '_ _ _ _ _' },
    { cipher: 'üèõÔ∏è Caesar (+1)', encoded: 'CZF', answer: 'BYE', hint: 'Shift each letter back by 1', blanks: '_ _ _' },
    { cipher: 'üèõÔ∏è Caesar (+1)', encoded: 'DBU', answer: 'CAT', hint: 'Shift each letter back by 1', blanks: '_ _ _' },
    
    // Caesar +3
    { cipher: 'üèõÔ∏è Caesar (+3)', encoded: 'KHOOR', answer: 'HELLO', hint: 'Shift each letter back by 3', blanks: '_ _ _ _ _' },
    { cipher: 'üèõÔ∏è Caesar (+3)', encoded: 'FDW', answer: 'CAT', hint: 'Shift each letter back by 3', blanks: '_ _ _' },
    
    // ROT13
    { cipher: 'üîÅ ROT13', encoded: 'URYYB', answer: 'HELLO', hint: 'Shift by 13', blanks: '_ _ _ _ _' },
    { cipher: 'üîÅ ROT13', encoded: 'FRPERG', answer: 'SECRET', hint: 'Shift by 13', blanks: '_ _ _ _ _ _' },
    
    // Atbash
    { cipher: 'üîÑ Atbash', encoded: 'SVOOL', answer: 'HELLO', hint: 'A‚ÜîZ, B‚ÜîY, C‚ÜîX...', blanks: '_ _ _ _ _' },
    { cipher: 'üîÑ Atbash', encoded: 'WLT', answer: 'DOG', hint: 'Flip the alphabet!', blanks: '_ _ _' },
    
    // A1Z26
    { cipher: 'üî¢ A1Z26', encoded: '8-5-12-12-15', answer: 'HELLO', hint: 'A=1, B=2, C=3...', blanks: '_ _ _ _ _' },
    { cipher: 'üî¢ A1Z26', encoded: '3-1-20', answer: 'CAT', hint: 'Numbers = letter positions', blanks: '_ _ _' },
    { cipher: 'üî¢ A1Z26', encoded: '19-16-25', answer: 'SPY', hint: 'Count the alphabet!', blanks: '_ _ _' },
    
    // Backwards
    { cipher: 'üîÄ Backwards', encoded: 'OLLEH', answer: 'HELLO', hint: 'Read it backwards!', blanks: '_ _ _ _ _' },
    { cipher: 'üîÄ Backwards', encoded: 'TERCES', answer: 'SECRET', hint: 'Reverse the letters!', blanks: '_ _ _ _ _ _' },
    
    // Leet Speak
    { cipher: 'üí¨ Leet Speak', encoded: 'H3LL0', answer: 'HELLO', hint: '3=E, 0=O', blanks: '_ _ _ _ _' },
    { cipher: 'üí¨ Leet Speak', encoded: 'H4CK3R', answer: 'HACKER', hint: '4=A, 3=E', blanks: '_ _ _ _ _ _' },
    { cipher: 'üí¨ Leet Speak', encoded: '1337', answer: 'LEET', hint: '1=L, 3=E, 7=T', blanks: '_ _ _ _' },
    
    // Morse Code
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚Ä¢‚Ä¢ ‚àí‚àí‚àí ‚Ä¢‚Ä¢‚Ä¢', answer: 'SOS', hint: 'S=‚Ä¢‚Ä¢‚Ä¢ O=‚àí‚àí‚àí', blanks: '_ _ _' },
    { cipher: 'üì° Morse Code', encoded: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢', answer: 'HI', hint: 'H=‚Ä¢‚Ä¢‚Ä¢‚Ä¢ I=‚Ä¢‚Ä¢', blanks: '_ _' },
    
    // Binary
    { cipher: 'üíª Binary', encoded: '01001000 01001001', answer: 'HI', hint: '8 digits = 1 letter', blanks: '_ _' },
    { cipher: 'üíª Binary', encoded: '01011001 01000101 01010011', answer: 'YES', hint: '8 digits = 1 letter', blanks: '_ _ _' },
    
    // Phone Keypad
    { cipher: 'üì± Phone Keypad', encoded: '44-33-555-555-666', answer: 'HELLO', hint: 'Count the digits!', blanks: '_ _ _ _ _' },
    { cipher: 'üì± Phone Keypad', encoded: '222-2-8', answer: 'CAT', hint: '222=C, 2=A, 8=T', blanks: '_ _ _' },
    
    // NATO Alphabet
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Hotel India', answer: 'HI', hint: 'First letter of each word!', blanks: '_ _' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Sierra Oscar Sierra', answer: 'SOS', hint: 'S=Sierra, O=Oscar', blanks: '_ _ _' },
    { cipher: '‚úàÔ∏è NATO Alphabet', encoded: 'Charlie Alpha Tango', answer: 'CAT', hint: 'First letters spell it!', blanks: '_ _ _' },
    
    // Pigpen
    { cipher: 'üê∑ Pigpen', encoded: '‚åê ‚äê ‚åêÃ≤ (shapes)', answer: 'ABC', hint: 'Match shapes to the grid!', blanks: '_ _ _' },
    { cipher: 'üê∑ Pigpen', encoded: '‚ñ° = this letter', answer: 'E', hint: 'E is in the center of the first grid', blanks: '_' },
    
    // Braille
    { cipher: '‚†É Braille', encoded: '‚†ì ‚†ä', answer: 'HI', hint: 'Look up the dot patterns!', blanks: '_ _' },
    { cipher: '‚†É Braille', encoded: '‚†é ‚†ï ‚†é', answer: 'SOS', hint: 'Match the dot patterns!', blanks: '_ _ _' },
    
    // Tap Code
    { cipher: 'üëä Tap Code', encoded: '‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢ / ‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢', answer: 'HI', hint: 'First taps=row, second=column', blanks: '_ _' },
    { cipher: 'üëä Tap Code', encoded: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢', answer: 'T', hint: 'Row 4, Column 4 = T', blanks: '_' },
    
    // Polybius Square
    { cipher: 'üèõÔ∏è Polybius Square', encoded: '23 15 31 31 34', answer: 'HELLO', hint: 'Row + Column numbers', blanks: '_ _ _ _ _' },
    { cipher: 'üèõÔ∏è Polybius Square', encoded: '13 11 44', answer: 'CAT', hint: '13=C, 11=A, 44=T', blanks: '_ _ _' },
    
    // Hexadecimal
    { cipher: 'üî¢ Hexadecimal', encoded: '48 49', answer: 'HI', hint: 'Hex to text!', blanks: '_ _' },
    { cipher: 'üî¢ Hexadecimal', encoded: '43 41 54', answer: 'CAT', hint: '43=C, 41=A, 54=T', blanks: '_ _ _' },
    
    // Keyboard Cipher
    { cipher: '‚å®Ô∏è Keyboard Cipher', encoded: 'JO', answer: 'HI', hint: 'Shifted right on keyboard', blanks: '_ _' },
    { cipher: '‚å®Ô∏è Keyboard Cipher', encoded: 'VSY', answer: 'CAT', hint: 'Shift left on keyboard!', blanks: '_ _ _' },
    
    // Runic/Viking
    { cipher: '·ö± Runic (Viking)', encoded: '·ö∫·õñ·õö·õö·õü', answer: 'HELLO', hint: 'Look up Elder Futhark!', blanks: '_ _ _ _ _' },
    { cipher: '·ö± Runic (Viking)', encoded: '·ö∫·õÅ', answer: 'HI', hint: '·ö∫=H, ·õÅ=I', blanks: '_ _' },
    
    // Vigen√®re
    { cipher: 'üîë Vigen√®re (key: KEY)', encoded: 'RIJVS', answer: 'HELLO', hint: 'Subtract KEY from each letter', blanks: '_ _ _ _ _' },
    { cipher: 'üîë Vigen√®re (key: ABC)', encoded: 'HJG', answer: 'HIG', hint: 'Subtract A=0, B=1, C=2', blanks: '_ _ _' },
    
    // Base64
    { cipher: 'üìß Base64', encoded: 'SGk=', answer: 'HI', hint: 'Use a Base64 decoder!', blanks: '_ _' },
    { cipher: 'üìß Base64', encoded: 'SEVMTE8=', answer: 'HELLO', hint: 'Ends with = sign', blanks: '_ _ _ _ _' },
    
    // Rail Fence
    { cipher: 'üöÇ Rail Fence (2 rails)', encoded: 'HLOEL', answer: 'HELLO', hint: 'Zigzag pattern!', blanks: '_ _ _ _ _' },
    { cipher: 'üöÇ Rail Fence (2 rails)', encoded: 'CTAT', answer: 'CTAT‚ÜíCAT', hint: 'Read zigzag: top then bottom', blanks: '_ _ _' },
    
    // Semaphore
    { cipher: 'üö© Semaphore', encoded: '‚Üô‚Üì ‚Üô‚Üê ‚Üô‚Üë', answer: 'ABC', hint: 'Flag arm positions!', blanks: '_ _ _' },
    { cipher: 'üö© Semaphore', encoded: 'Arms point different ways', answer: 'LETTERS', hint: 'Each position = a letter', blanks: '_ _ _ _ _ _ _' },
    
    // Book Cipher
    { cipher: 'üìö Book Cipher', encoded: '5-3-2 means...', answer: 'PAGE5 LINE3 WORD2', hint: 'Page-Line-Word format!', blanks: '_ _ _ _ _' },
    
    // Scytale
    { cipher: 'üìú Scytale', encoded: 'HSJEICLPREYTS', answer: 'SECRETSHPY', hint: 'Wrap around a rod!', blanks: '_ _ _ _ _ _' },
    
    // Mirror Writing
    { cipher: 'ü™û Mirror Writing', encoded: 'OLL∆éH', answer: 'HELLO', hint: 'Hold up to a mirror!', blanks: '_ _ _ _ _' },
    { cipher: 'ü™û Mirror Writing', encoded: 'IH', answer: 'HI', hint: 'Flip horizontally!', blanks: '_ _' },
    
    // Null Cipher
    { cipher: 'üëÄ Null Cipher', encoded: 'Have Everyone Loving Pizza', answer: 'HELP', hint: 'First letters!', blanks: '_ _ _ _' },
    { cipher: 'üëÄ Null Cipher', encoded: 'Send Over Some', answer: 'SOS', hint: 'Read first letters of each word', blanks: '_ _ _' },
    
    // Dancing Men
    { cipher: 'üï∫ Dancing Men', encoded: 'Stick figures dancing', answer: 'LETTERS', hint: 'From Sherlock Holmes!', blanks: '_ _ _ _ _ _ _' },
    
    // Playfair
    { cipher: 'üé≠ Playfair', encoded: 'Pairs of letters', answer: 'MESSAGE', hint: 'Uses a 5x5 grid + keyword!', blanks: '_ _ _ _ _ _ _' },
    
    // Bacon's Cipher
    { cipher: 'ü•ì Bacon\'s Cipher', encoded: 'AAAAA AAAAB AAABA', answer: 'ABC', hint: '5 letters of A/B = 1 letter', blanks: '_ _ _' },
    { cipher: 'ü•ì Bacon\'s Cipher', encoded: 'Two text styles hide message', answer: 'SECRET', hint: 'Bold vs normal = A vs B', blanks: '_ _ _ _ _ _' },
    
    // Enigma
    { cipher: '‚öôÔ∏è Enigma', encoded: 'Machine settings needed!', answer: 'VARIES', hint: 'WWII cipher machine', blanks: '_ _ _ _ _ _' },
    
    // Templar
    { cipher: '‚öîÔ∏è Templar', encoded: 'Cross shapes with dots', answer: 'LETTERS', hint: 'Like Pigpen but with crosses!', blanks: '_ _ _ _ _ _ _' },
    
    // Maritime Flags
    { cipher: 'üö¢ Maritime Flags', encoded: 'üîµ‚¨ú = ?', answer: 'A (ALPHA)', hint: 'Each flag = letter + meaning!', blanks: '_' },
    { cipher: 'üö¢ Maritime Flags', encoded: 'Red/white stripes', answer: 'HOTEL (H)', hint: 'Look up signal flags!', blanks: '_' },
    
    // Wingdings
    { cipher: '‚úåÔ∏è Wingdings', encoded: '‚úå = ?', answer: 'A', hint: 'Change font back to normal!', blanks: '_' },
    { cipher: '‚úåÔ∏è Wingdings', encoded: 'Symbols in Wingdings font', answer: 'TEXT', hint: 'Copy & change font to Arial', blanks: '_ _ _ _' },
    
    // Columnar Transposition
    { cipher: 'üìä Columnar', encoded: 'EOOHLO LWD (key CAT)', answer: 'HELLOWORLD', hint: 'Rearrange columns by keyword!', blanks: '_ _ _ _ _' },
];

let selectedCiphers = [];
let currentQuestions = [];
let currentIndex = 0;
let knownCount = 0;
let learningCount = 0;

// Reference charts for each cipher
const cipherCharts = {
    'üì° Morse Code': `MORSE CODE ALPHABET:
A = ‚Ä¢‚àí      N = ‚àí‚Ä¢
B = ‚àí‚Ä¢‚Ä¢‚Ä¢    O = ‚àí‚àí‚àí
C = ‚àí‚Ä¢‚àí‚Ä¢    P = ‚Ä¢‚àí‚àí‚Ä¢
D = ‚àí‚Ä¢‚Ä¢     Q = ‚àí‚àí‚Ä¢‚àí
E = ‚Ä¢       R = ‚Ä¢‚àí‚Ä¢
F = ‚Ä¢‚Ä¢‚àí‚Ä¢    S = ‚Ä¢‚Ä¢‚Ä¢
G = ‚àí‚àí‚Ä¢     T = ‚àí
H = ‚Ä¢‚Ä¢‚Ä¢‚Ä¢    U = ‚Ä¢‚Ä¢‚àí
I = ‚Ä¢‚Ä¢      V = ‚Ä¢‚Ä¢‚Ä¢‚àí
J = ‚Ä¢‚àí‚àí‚àí    W = ‚Ä¢‚àí‚àí
K = ‚àí‚Ä¢‚àí     X = ‚àí‚Ä¢‚Ä¢‚àí
L = ‚Ä¢‚àí‚Ä¢‚Ä¢    Y = ‚àí‚Ä¢‚àí‚àí
M = ‚àí‚àí      Z = ‚àí‚àí‚Ä¢‚Ä¢`,

    'üî¢ A1Z26': `A1Z26 NUMBER CODE:
A=1   B=2   C=3   D=4   E=5
F=6   G=7   H=8   I=9   J=10
K=11  L=12  M=13  N=14  O=15
P=16  Q=17  R=18  S=19  T=20
U=21  V=22  W=23  X=24  Y=25  Z=26`,

    '‚úàÔ∏è NATO Alphabet': `NATO PHONETIC ALPHABET:
A = Alpha      N = November
B = Bravo      O = Oscar
C = Charlie    P = Papa
D = Delta      Q = Quebec
E = Echo       R = Romeo
F = Foxtrot    S = Sierra
G = Golf       T = Tango
H = Hotel      U = Uniform
I = India      V = Victor
J = Juliet     W = Whiskey
K = Kilo       X = X-ray
L = Lima       Y = Yankee
M = Mike       Z = Zulu`,

    '‚†É Braille': `BRAILLE ALPHABET:
‚†Å=A  ‚†É=B  ‚†â=C  ‚†ô=D  ‚†ë=E
‚†ã=F  ‚†õ=G  ‚†ì=H  ‚†ä=I  ‚†ö=J
‚†Ö=K  ‚†á=L  ‚†ç=M  ‚†ù=N  ‚†ï=O
‚†è=P  ‚†ü=Q  ‚†ó=R  ‚†é=S  ‚†û=T
‚†•=U  ‚†ß=V  ‚†∫=W  ‚†≠=X  ‚†Ω=Y  ‚†µ=Z`,

    'üèõÔ∏è Caesar (+1)': `CAESAR CIPHER (+1):
A‚ÜíB  B‚ÜíC  C‚ÜíD  D‚ÜíE  E‚ÜíF  F‚ÜíG
G‚ÜíH  H‚ÜíI  I‚ÜíJ  J‚ÜíK  K‚ÜíL  L‚ÜíM
M‚ÜíN  N‚ÜíO  O‚ÜíP  P‚ÜíQ  Q‚ÜíR  R‚ÜíS
S‚ÜíT  T‚ÜíU  U‚ÜíV  V‚ÜíW  W‚ÜíX  X‚ÜíY
Y‚ÜíZ  Z‚ÜíA

To DECODE: shift BACK by 1`,

    'üèõÔ∏è Caesar (+3)': `CAESAR CIPHER (+3):
A‚ÜíD  B‚ÜíE  C‚ÜíF  D‚ÜíG  E‚ÜíH  F‚ÜíI
G‚ÜíJ  H‚ÜíK  I‚ÜíL  J‚ÜíM  K‚ÜíN  L‚ÜíO
M‚ÜíP  N‚ÜíQ  O‚ÜíR  P‚ÜíS  Q‚ÜíT  R‚ÜíU
S‚ÜíV  T‚ÜíW  U‚ÜíX  V‚ÜíY  W‚ÜíZ  X‚ÜíA
Y‚ÜíB  Z‚ÜíC

To DECODE: shift BACK by 3`,

    'üîÅ ROT13': `ROT13 (Shift by 13):
A‚ÜîN  B‚ÜîO  C‚ÜîP  D‚ÜîQ  E‚ÜîR  F‚ÜîS  G‚ÜîT
H‚ÜîU  I‚ÜîV  J‚ÜîW  K‚ÜîX  L‚ÜîY  M‚ÜîZ

Apply ROT13 twice = back to original!`,

    'üîÑ Atbash': `ATBASH (Reverse Alphabet):
A‚ÜîZ  B‚ÜîY  C‚ÜîX  D‚ÜîW  E‚ÜîV  F‚ÜîU  G‚ÜîT
H‚ÜîS  I‚ÜîR  J‚ÜîQ  K‚ÜîP  L‚ÜîO  M‚ÜîN`,

    'üîÄ Backwards': `BACKWARDS:
Just write it in reverse!
HELLO ‚Üí OLLEH
SECRET ‚Üí TERCES`,

    'üí¨ Leet Speak': `LEET SPEAK:
A = 4    E = 3    I = 1
O = 0    S = 5    T = 7
B = 8    G = 9    L = 1`,

    'üíª Binary': `BINARY (8 bits per letter):
A = 01000001    N = 01001110
B = 01000010    O = 01001111
C = 01000011    S = 01010011
H = 01001000    T = 01010100
I = 01001001    Y = 01011001`,

    'üì± Phone Keypad': `PHONE KEYPAD:
2 = ABC    5 = JKL    8 = TUV
3 = DEF    6 = MNO    9 = WXYZ
4 = GHI    7 = PQRS

Count presses: 2=A, 22=B, 222=C`,

    'üê∑ Pigpen': `PIGPEN CIPHER:
 A‚îÇB‚îÇC     Draw the lines around
‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ   each letter!
 D‚îÇE‚îÇF     
‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îº‚îÄ‚îÄ   A = ‚åê  E = ‚ñ°
 G‚îÇH‚îÇI`,

    'üëä Tap Code': `TAP CODE (5x5 Grid):
    1   2   3   4   5
1   A   B   C   D   E
2   F   G   H   I   J
3   L   M   N   O   P
4   Q   R   S   T   U
5   V   W   X   Y   Z
(K=C) First taps=row, Second=column`,

    'üèõÔ∏è Polybius Square': `POLYBIUS SQUARE:
    1   2   3   4   5
1   A   B   C   D   E
2   F   G   H   I   J
3   L   M   N   O   P
4   Q   R   S   T   U
5   V   W   X   Y   Z

Write: Row number + Column number`,

    'üî¢ Hexadecimal': `HEXADECIMAL (Hex):
A=41  B=42  C=43  D=44  E=45
F=46  G=47  H=48  I=49  J=4A
K=4B  L=4C  M=4D  N=4E  O=4F
P=50  Q=51  R=52  S=53  T=54`,

    '‚å®Ô∏è Keyboard Cipher': `KEYBOARD CIPHER:
Q W E R T Y U I O P
 A S D F G H J K L
  Z X C V B N M

Shift letters left or right!`,

    '·ö± Runic (Viking)': `ELDER FUTHARK RUNES:
·ö†=F  ·ö¢=U  ·ö¶=TH ·ö®=A  ·ö±=R  ·ö≤=K
·ö∑=G  ·öπ=W  ·ö∫=H  ·öæ=N  ·õÅ=I  ·õÉ=J
·õà=P  ·õâ=Z  ·õä=S  ·õè=T  ·õí=B  ·õñ=E
·õó=M  ·õö=L  ·õú=NG ·õû=D  ·õü=O`,
};

// Get unique cipher types from quizData
const cipherTypes = [...new Set(quizData.map(q => q.cipher))];

function populateSelect() {
    const container = document.getElementById('cipherSelect');
    container.innerHTML = cipherTypes.map(c => `
        <div class="cipher-opt selected" onclick="toggleSelect('${c}')">
            <input type="checkbox" id="sel-${c.replace(/[^a-z0-9]/gi, '')}" checked>
            <span class="check">‚úì</span>
            <span>${c}</span>
        </div>
    `).join('');
}

function toggleSelect(cipher) {
    const id = cipher.replace(/[^a-z0-9]/gi, '');
    const opt = document.querySelector(`#sel-${id}`).parentElement;
    const cb = document.querySelector(`#sel-${id}`);
    cb.checked = !cb.checked;
    opt.classList.toggle('selected', cb.checked);
}

function selectAll() {
    document.querySelectorAll('.cipher-opt').forEach(opt => {
        opt.classList.add('selected');
        opt.querySelector('input').checked = true;
    });
}

function selectNone() {
    document.querySelectorAll('.cipher-opt').forEach(opt => {
        opt.classList.remove('selected');
        opt.querySelector('input').checked = false;
    });
}

function startQuiz() {
    selectedCiphers = [];
    document.querySelectorAll('.cipher-opt input:checked').forEach(cb => {
        const label = cb.parentElement.querySelector('span:last-child').textContent;
        selectedCiphers.push(label);
    });

    if (selectedCiphers.length === 0) {
        alert('Pick at least one cipher!');
        return;
    }

    // Filter questions for selected ciphers
    currentQuestions = quizData.filter(q => selectedCiphers.includes(q.cipher));
    
    // Shuffle
    currentQuestions = currentQuestions.sort(() => Math.random() - 0.5);
    
    // Limit to 10 questions max
    currentQuestions = currentQuestions.slice(0, 10);
    
    currentIndex = 0;
    knownCount = 0;
    learningCount = 0;

    document.getElementById('setup').style.display = 'none';
    document.getElementById('quizArea').classList.add('active');
    document.getElementById('results').classList.remove('active');

    document.getElementById('total').textContent = currentQuestions.length;
    document.getElementById('score').textContent = 0;
    
    showQuestion();
}

function showQuestion() {
    if (currentIndex >= currentQuestions.length) {
        showResults();
        return;
    }

    const q = currentQuestions[currentIndex];
    document.getElementById('cipherName').textContent = q.cipher;
    document.getElementById('encodedText').textContent = q.encoded;
    document.getElementById('hintText').textContent = q.hint;
    document.getElementById('answerWord').textContent = q.answer;
    document.getElementById('wrongAnswer').textContent = q.answer;
    
    // Load the reference chart for this cipher
    const chart = cipherCharts[q.cipher] || 'No reference chart available for this cipher.';
    document.getElementById('chartContent').textContent = chart;
    
    // Reset state
    document.getElementById('answerInput').value = '';
    document.getElementById('answerInput').disabled = false;
    document.getElementById('answerInput').focus();
    document.getElementById('correctBox').style.display = 'none';
    document.getElementById('wrongBox').style.display = 'none';
    document.getElementById('revealBtn').style.display = 'inline-block';
    document.getElementById('nextBtn').style.display = 'none';
    document.getElementById('gotitBtn').style.display = 'none';
    document.getElementById('referenceChart').classList.remove('show');
    document.querySelector('.chart-toggle').textContent = 'üìñ Show Reference Chart';
    
    document.getElementById('current').textContent = currentIndex + 1;
    document.getElementById('progressFill').style.width = ((currentIndex / currentQuestions.length) * 100) + '%';
}

function checkAnswer() {
    const input = document.getElementById('answerInput').value.trim().toUpperCase();
    const q = currentQuestions[currentIndex];
    const correct = q.answer.toUpperCase();
    
    if (!input) {
        alert('Type an answer first!');
        return;
    }
    
    document.getElementById('answerInput').disabled = true;
    document.getElementById('revealBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'inline-block';
    
    // Check if correct
    if (input === correct) {
        // Correct!
        document.getElementById('correctBox').style.display = 'block';
        knownCount++;
        document.getElementById('score').textContent = knownCount;
    } else {
        // Wrong - show what they typed and the correct answer
        document.getElementById('yourAnswer').textContent = input || '(nothing)';
        document.getElementById('wrongBox').style.display = 'block';
        learningCount++;
    }
}

function revealAnswer() {
    const q = currentQuestions[currentIndex];
    const input = document.getElementById('answerInput').value.trim().toUpperCase();
    document.getElementById('yourAnswer').textContent = input || "(didn't answer)";
    document.getElementById('wrongBox').style.display = 'block';
    document.getElementById('answerInput').disabled = true;
    document.getElementById('revealBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'inline-block';
    document.getElementById('gotitBtn').style.display = 'none';
    learningCount++;
}

function nextQuestion() {
    currentIndex++;
    showQuestion();
}

function toggleChart() {
    const chart = document.getElementById('referenceChart');
    const btn = document.querySelector('.chart-toggle');
    const gotitBtn = document.getElementById('gotitBtn');
    
    if (chart.classList.contains('show')) {
        chart.classList.remove('show');
        btn.textContent = 'üìñ Show Reference Chart';
        gotitBtn.style.display = 'none';
    } else {
        chart.classList.add('show');
        btn.textContent = 'üìñ Hide Reference Chart';
        gotitBtn.style.display = 'inline-block';
    }
}

function gotIt() {
    // Hide the chart - they've memorized it!
    document.getElementById('referenceChart').classList.remove('show');
    document.querySelector('.chart-toggle').textContent = 'üìñ Show Reference Chart';
    document.getElementById('gotitBtn').style.display = 'none';
}

function showResults() {
    document.getElementById('quizArea').classList.remove('active');
    document.getElementById('results').classList.add('active');
    
    document.getElementById('knownCount').textContent = knownCount;
    document.getElementById('learningCount').textContent = learningCount;
    
    const percent = Math.round((knownCount / currentQuestions.length) * 100);
    let message = '';
    let emoji = 'üéâ';
    
    if (percent === 100) {
        message = 'PERFECT! You\'re a cipher master! üèÜ';
        emoji = 'üèÜ';
    } else if (percent >= 80) {
        message = 'Amazing! Almost perfect! üåü';
        emoji = 'üåü';
    } else if (percent >= 60) {
        message = 'Great job! Keep practicing! üí™';
        emoji = 'üí™';
    } else if (percent >= 40) {
        message = 'Good effort! Practice more! üìö';
        emoji = 'üìö';
    } else {
        message = 'Keep learning! You\'ll get it! üîê';
        emoji = 'üîê';
    }
    
    document.getElementById('resultMessage').textContent = message;
    document.querySelector('.results .emoji').textContent = emoji;
}

function restart() {
    currentQuestions = currentQuestions.sort(() => Math.random() - 0.5);
    currentIndex = 0;
    knownCount = 0;
    learningCount = 0;
    
    document.getElementById('results').classList.remove('active');
    document.getElementById('quizArea').classList.add('active');
    document.getElementById('score').textContent = 0;
    
    showQuestion();
}

function backToSetup() {
    document.getElementById('results').classList.remove('active');
    document.getElementById('quizArea').classList.remove('active');
    document.getElementById('setup').style.display = 'block';
}

// Initialize
populateSelect();
</script>

</body>
</html>